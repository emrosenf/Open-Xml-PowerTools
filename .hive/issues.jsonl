{"id":"cell--tsysh-mjn0oh7mgrm","title":"Phase 2: WmlComparer Port (Faithful Translation)","description":"**Phase 2: WmlComparer Port (100% Faithful C# Translation)**\n\n## Methodology (NON-NEGOTIABLE)\n1. **Translation-first**: Port C# code line-by-line, preserving structure and naming\n2. **No behavior inference**: Never guess what C# does from test outputs\n3. **Tests validate, not guide**: Run tests only AFTER implementation complete\n4. **When stuck**: Read C# source (WmlComparer.cs:line), not test expectations\n5. **Naming convention**: Rust functions mirror C# method names\n\n## Source Files to Port\n- WmlComparer.cs (8836 lines) - Main comparer\n- RevisionProcessor.cs (~800 lines) - Accept/Reject revisions\n- MarkupSimplifier.cs (~600 lines) - Markup preprocessing\n\n## Target: 539 WML tests pass (268 + 251 + 20 formatting)\n\n## Reference: RUST_MIGRATION_PLAN_SYNTHESIS.md Section 2","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T15:18:58.594Z","updated_at":"2025-12-26T15:49:25.493Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfdtjc","title":"WmlComparer Performance Analysis & Rust Optimization","description":"Analyze performance hotspots in WmlComparer and provide Rust implementation optimizations while maintaining byte-for-byte compatibility","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-26T15:43:09.097Z","updated_at":"2025-12-26T15:49:16.216Z","closed_at":"2025-12-26T15:49:16.216Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfiicu","title":"Analyze Atomization Performance Hotspots","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:43:09.102Z","updated_at":"2025-12-26T15:43:14.918Z","closed_at":"2025-12-26T15:43:14.918Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfkk15","title":"Analyze LCS Algorithm Quadratic Complexity","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:43:09.104Z","updated_at":"2025-12-26T15:43:20.843Z","closed_at":"2025-12-26T15:43:20.843Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkflqv3","title":"Analyze Coalescing & XML Traversal Costs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:43:09.105Z","updated_at":"2025-12-26T15:43:26.056Z","closed_at":"2025-12-26T15:43:26.056Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfnmvo","title":"Design Optimized Rust Data Structures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:43:09.107Z","updated_at":"2025-12-26T15:43:33.904Z","closed_at":"2025-12-26T15:43:33.904Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfpw9w","title":"Implement Memory-Efficient LCS Algorithm","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:43:09.109Z","updated_at":"2025-12-26T15:43:38.512Z","closed_at":"2025-12-26T15:43:38.512Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfqdsq","title":"Optimize Atomization with Streaming Approach","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:43:09.110Z","updated_at":"2025-12-26T15:43:42.989Z","closed_at":"2025-12-26T15:43:42.989Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn1jkfs9rn","title":"Add Performance Benchmarks","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T15:43:09.112Z","updated_at":"2025-12-26T15:43:47.261Z","closed_at":"2025-12-26T15:43:47.261Z","parent_id":"cell--tsysh-mjn1jkfdtjc","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh7t5sd","title":"2.1 Types and Settings","description":"**Port WmlComparerSettings and WmlComparerRevision**\n\nFiles: wml/settings.rs (update existing)\n\n## C# Sources\n- WmlComparerSettings (WmlComparer.cs:64-100)\n- WmlComparerConsolidateSettings (WmlComparer.cs:109)\n- WmlRevisedDocumentInfo (WmlComparer.cs:114)\n- WmlComparerRevision + WmlComparerRevisionType (WmlComparer.cs:3861-3884)\n\n## Fields to Port (EXACT defaults required)\n- WordSeparators: char[] with Chinese punctuation (line 100)\n- AuthorForRevisions: Option<String>\n- DateTimeForRevisions: ISO 8601 format\n- DetailThreshold: f64 = 0.15\n- CaseInsensitive: bool = false\n- ConflateBreakingAndNonbreakingSpaces: bool = true\n- TrackFormattingChanges: bool = true\n- CultureInfo: Option<String>\n- StartingIdForFootnotesEndnotes: i32 = 1\n\n## Rust File: redline-rs/crates/redline-core/src/wml/settings.rs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:18:58.601Z","updated_at":"2025-12-26T16:17:00.981Z","closed_at":"2025-12-26T16:17:00.981Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh7v9ah","title":"2.2 Comparison Units","description":"**Port ComparisonUnit Hierarchy**\n\nFiles: wml/comparison_unit.rs (rewrite for faithful port)\n\n## C# Sources (WmlComparer.cs)\n- ComparisonUnit abstract base (line 8157-8210)\n- ComparisonUnitWord (line 8212-8278)\n- ComparisonUnitAtom (line 8280-8596)\n- ComparisonUnitGroup (line 8608-8690)\n- ComparisonUnitGroupType enum (line 8599-8606)\n- CorrelationStatus enum (line 8597)\n\n## Critical Fields in ComparisonUnitAtom\n- AncestorElements: XElement[] (body ‚Üí leaf order)\n- AncestorUnids: String[]\n- ContentElement: XElement\n- Part: OpenXmlPart reference\n- SHA1Hash: computed from content\n- CorrelationStatus: Equal/Inserted/Deleted/Unknown\n- NormalizedRPr: for formatting comparison\n- FormattingSignature: String hash of rPr\n\n## Rust File: redline-rs/crates/redline-core/src/wml/comparison_unit.rs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:18:58.603Z","updated_at":"2025-12-26T16:17:01.335Z","closed_at":"2025-12-26T16:17:01.335Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh7xg1i","title":"2.3 RevisionProcessor Port","description":"**Port RevisionProcessor (AcceptRevisions/RejectRevisions)**\n\nFiles: NEW wml/revision_processor.rs\n\n## C# Sources\n- RevisionProcessor.cs (full file ~800 lines)\n- Used by CompareInternal at lines 226-227, 255-256\n\n## Methods to Port\n1. AcceptRevisions(WmlDocument) ‚Üí WmlDocument\n2. RejectRevisions(WmlDocument) ‚Üí WmlDocument\n3. AcceptRevisionsForElement(element) - element-level accept\n\n## Purpose in Compare Flow\n1. source1afterAccepting = AcceptRevisions(source1)\n2. source2afterRejecting = RejectRevisions(source2)\n3. Used for HashBlockLevelContent correlation\n4. Re-accept after hashing for actual comparison\n\n## Rust File: redline-rs/crates/redline-core/src/wml/revision_processor.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.605Z","updated_at":"2025-12-26T16:17:01.863Z","closed_at":"2025-12-26T16:17:01.863Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh7yx5o","title":"2.4 MarkupSimplifier Port","description":"**Port MarkupSimplifier**\n\nFiles: NEW wml/simplify.rs\n\n## C# Sources\n- MarkupSimplifier.cs (full file ~600 lines)\n- Called by PreProcessMarkup in WmlComparer\n\n## Key Operations\n1. Merge adjacent runs with same formatting\n2. Remove empty runs and paragraphs\n3. Normalize bookmarks and fields\n4. Handle tracked changes cleanup\n5. Process alternate content (MC:AlternateContent)\n\n## Rust File: redline-rs/crates/redline-core/src/wml/simplify.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.606Z","updated_at":"2025-12-26T16:17:02.293Z","closed_at":"2025-12-26T16:17:02.293Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh85k0v","title":"2.8 Formatting Changes","description":"**Port Formatting Change Detection**\n\nFiles: wml/formatting.rs (update existing)\n\n## C# Sources (WmlComparer.cs)\n- NormalizedRPr computation (line 8380-8466)\n- FormattingSignature generation (line 8298-8310)\n- FormattingChangeRPrBefore handling (line 8300-8345)\n- rPrChange generation in CoalesceRecurse\n\n## Key Logic\n1. Compute NormalizedRPr from w:rPr element\n2. Generate SHA1 FormattingSignature from normalized props\n3. Compare signatures between matched atoms\n4. Generate w:rPrChange elements for format differences\n5. Use TrackFormattingChanges setting\n\n## Rust File: redline-rs/crates/redline-core/src/wml/formatting.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.613Z","updated_at":"2025-12-26T16:38:52.267Z","closed_at":"2025-12-26T16:38:52.267Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh86fdp","title":"2.9 Tree Reconstruction","description":"**Port CoalesceRecurse (Tree Reconstruction)**\n\nFiles: wml/coalesce.rs (rewrite for faithful port)\n\n## C# Sources (WmlComparer.cs)\n- Coalesce() entry (line 7977-7992)\n- CoalesceRecurse() (line 5161-5738)\n- MoveLastSectPrToChildOfBody (line 7987)\n- AssembleAncestorUnidsInOrderToRebuildXmlTreeProperly (line 5043-5012)\n\n## Grouping Logic (CRITICAL)\n1. Group atoms by AncestorUnids[level]\n2. Also group by CorrelationStatus (don't merge across status boundaries)\n3. Also group by FormattingSignature (format change boundaries)\n4. Recurse at each level to build hierarchy\n\n## Special Cases\n- VML/textbox handling (preserve \"before ancestors\")\n- Table structure reconstruction\n- Empty key handling (drop from grouping)\n\n## Rust File: redline-rs/crates/redline-core/src/wml/coalesce.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.614Z","updated_at":"2025-12-26T16:38:53.178Z","closed_at":"2025-12-26T16:38:53.178Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh88t77","title":"2.10 Element Ordering","description":"**Port Element Ordering + MarkContentAsDeletedOrInserted**\n\nFiles: wml/order.rs, wml/mark_revisions.rs\n\n## C# Sources\n- WmlOrderElementsPerStandard (PtOpenXmlUtil.cs)\n- Order_pPr, Order_rPr dictionaries\n- MarkContentAsDeletedOrInserted (WmlComparer.cs:2646)\n- MarkContentAsDeletedOrInsertedTransform (line 2652-2740)\n- FixUpRevisionIds (line 2742-2965)\n\n## Element Ordering\n- Ensure output XML element order matches OOXML standard\n- Critical for: pPr, rPr, tblPr, tcPr, trPr\n\n## Revision Markup Transform\n1. For w:r: wrap in w:del or w:ins based on PtOpenXml.Status\n2. For w:pPr: inject w:rPr with w:del or w:ins markers\n3. Add w:author, w:id, w:date attributes\n4. Sequential ID assignment (s_MaxId++)\n\n## Rust Files: \n- redline-rs/crates/redline-core/src/wml/order.rs\n- redline-rs/crates/redline-core/src/wml/mark_revisions.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.616Z","updated_at":"2025-12-26T16:38:54.967Z","closed_at":"2025-12-26T16:38:54.967Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh8axgq","title":"2.11 Consolidation","description":"**Port Consolidate + GetRevisions**\n\nFiles: wml/consolidate.rs, wml/get_revisions.rs\n\n## C# Sources (WmlComparer.cs)\n- Consolidate() overloads (line 994-1040)\n- ConsolidateInternal (line 1042-1800)\n- ConsolidationInfo class (internal)\n- GetRevisions() (line 3887-3960)\n- WmlComparerRevision extraction logic\n\n## Consolidate Logic\n1. Compare original with each revised document\n2. Merge revision markup from multiple authors\n3. Handle overlapping revisions\n4. Color-code by author (ColorParser)\n\n## GetRevisions Logic\n1. Find all w:ins, w:del elements in document\n2. Extract text, author, date, revision type\n3. Return List<WmlComparerRevision>\n\n## Rust Files:\n- redline-rs/crates/redline-core/src/wml/consolidate.rs\n- redline-rs/crates/redline-core/src/wml/get_revisions.rs","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T15:18:58.618Z","updated_at":"2025-12-26T16:38:56.249Z","closed_at":"2025-12-26T16:38:56.249Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh80z4a","title":"2.5 Preprocessing","description":"**Port PreProcessMarkup Pipeline**\n\nFiles: wml/preprocess.rs (update existing)\n\n## C# Sources (WmlComparer.cs)\n- PreProcessMarkup (line ~175-225)\n- AssignUnidToAllElements (line 8136)\n- HashBlockLevelContent (line 241-242)\n- MoveLastSectPrIntoLastParagraph (line 7994)\n\n## Pipeline Steps (EXACT order required)\n1. SimplifyMarkup() - normalize document\n2. AssignUnidToAllElements() - add pt:Unid GUIDs\n3. Accept/Reject revisions for hashing\n4. HashBlockLevelContent() - add pt:SHA1Hash, pt:CorrelatedSHA1Hash\n5. Repair Unids after SDK revision acceptance\n\n## Rust File: redline-rs/crates/redline-core/src/wml/preprocess.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:18:58.608Z","updated_at":"2025-12-26T16:54:10.866Z","closed_at":"2025-12-26T16:54:10.866Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh8250l","title":"2.6 LCS Algorithm","description":"**Port Full LCS Algorithm**\n\nFiles: wml/lcs.rs (rewrite for faithful port)\n\n## C# Sources (WmlComparer.cs)\n- Lcs main loop (line 5779-5936)\n- SetAfterUnids (line 5848-5936)\n- ProcessCorrelatedHashes (line 5938-6137)\n- FindCommonAtBeginningAndEnd (line 4489-4972)\n- DoLcsAlgorithm (line 6148-6724)\n- DoLcsAlgorithmForTable (line 7145)\n- DetectUnrelatedSources (line 5745)\n\n## Decision Chain (EXACT order in loop)\n1. SetAfterUnids(unknown) - propagate GUIDs\n2. ProcessCorrelatedHashes(unknown) - hash-driven matching\n3. FindCommonAtBeginningAndEnd(unknown) - prefix/suffix trim\n4. DoLcsAlgorithm(unknown) - core LCS search\n\n## DetailThreshold Gate\n- Discard matches below 15% of total window\n\n## Rust File: redline-rs/crates/redline-core/src/wml/lcs.rs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T15:18:58.610Z","updated_at":"2025-12-26T16:54:12.637Z","closed_at":"2025-12-26T16:54:12.637Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbizoa","title":"Deep Analysis of WmlComparer C# Implementation","description":"Analyze the C# WmlComparer implementation focusing on LCS algorithm, ContentAtom comparison, CorrelationStatus logic, hash-based equality checks, and edge case handling.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-26T17:11:54.222Z","updated_at":"2025-12-26T17:12:20.944Z","closed_at":"2025-12-26T17:12:20.944Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppboxp0","title":"Analyze LCS Algorithm Implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:11:54.228Z","updated_at":"2025-12-26T17:11:58.307Z","closed_at":"2025-12-26T17:11:58.307Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbq8u8","title":"Examine ContentAtom Comparison Logic","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:11:54.230Z","updated_at":"2025-12-26T17:12:02.334Z","closed_at":"2025-12-26T17:12:02.334Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbslxv","title":"Review CorrelationStatus Assignment","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:11:54.232Z","updated_at":"2025-12-26T17:12:06.487Z","closed_at":"2025-12-26T17:12:06.487Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbu7k6","title":"Investigate Hash-Based Equality Checks","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:11:54.234Z","updated_at":"2025-12-26T17:12:10.630Z","closed_at":"2025-12-26T17:12:10.630Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbwoy5","title":"Document Edge Case Handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:11:54.236Z","updated_at":"2025-12-26T17:12:14.885Z","closed_at":"2025-12-26T17:12:14.885Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4ppbx8v4","title":"Synthesize Findings and Create Report","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T17:11:54.237Z","updated_at":"2025-12-26T17:12:18.919Z","closed_at":"2025-12-26T17:12:18.919Z","parent_id":"cell--tsysh-mjn4ppbizoa","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4tjeucs9","title":"Fix LCS Algorithm Bugs in Rust Port","description":"Address critical bugs in the Rust port of the C# LCS algorithm that could cause incorrect document comparison results","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T17:14:53.190Z","updated_at":"2025-12-26T17:14:53.190Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4tjf3bdw","title":"Add regression tests for LCS algorithm edge cases","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T17:14:53.199Z","updated_at":"2025-12-26T17:14:53.199Z","parent_id":"cell--tsysh-mjn4tjeucs9","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn0oh83tby","title":"2.7 Core Comparison","description":"**Port Core Comparison (ProduceDocumentWithTrackedRevisions)**\n\nFiles: wml/comparer.rs (rewrite for faithful port)\n\n## Status: Pipeline Complete, Revision Counting Issue\n\nThe full pipeline is now wired up:\n1. ‚úÖ PreProcessMarkup both docs\n2. ‚úÖ CreateComparisonUnitAtomList on each part\n3. ‚úÖ GetComparisonUnitList ‚Üí hierarchical grouping\n4. ‚úÖ Lcs() ‚Üí correlate sequences\n5. ‚úÖ FlattenToComparisonUnitAtomList ‚Üí back to atoms\n6. ‚úÖ CoalesceRecurse ‚Üí rebuild XML tree\n7. ‚úÖ XML serialization to result document bytes\n\n## Current Issue\nTests show 0 revisions for most text-change scenarios. The `count_revision_atoms` \nfunction gets no Inserted/Deleted atoms from `flatten_to_atoms`. Either:\n- Atoms aren't being extracted correctly\n- LCS is treating everything as Equal\n- Or the hash comparison is matching when it shouldn't\n\nNeeds debugging at the atom extraction level to trace why text changes\naren't generating Deleted/Inserted statuses.\n\n## Rust File: redline-rs/crates/redline-core/src/wml/comparer.rs","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-26T15:18:58.611Z","updated_at":"2025-12-26T20:37:02.512Z","closed_at":"2025-12-26T20:37:02.512Z","parent_id":"cell--tsysh-mjn0oh7mgrm","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4tjf0tzr","title":"Fix flatten_to_atoms Equal case to use correct document content","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-26T17:14:53.196Z","updated_at":"2025-12-26T20:37:04.514Z","closed_at":"2025-12-26T20:37:04.514Z","parent_id":"cell--tsysh-mjn4tjeucs9","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjn4tjf25oj","title":"Add missing count_common_at_end == 2 logic in find_common_at_beginning_and_end","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T17:14:53.198Z","updated_at":"2025-12-26T20:47:35.504Z","closed_at":"2025-12-26T20:47:35.504Z","parent_id":"cell--tsysh-mjn4tjeucs9","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6a7rr","title":"Verify and Close C# Parity Gaps in LCS Algorithm","description":"Comprehensive verification of C# WmlComparer LCS algorithm parity with Rust port, identifying and closing all implementation gaps","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T21:28:39.586Z","updated_at":"2025-12-26T21:28:39.586Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6hsq6","title":"Detailed gap analysis: Compare C# vs Rust line-by-line for FindCommonAtBeginningAndEnd","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T21:28:39.593Z","updated_at":"2025-12-26T21:28:39.593Z","parent_id":"cell--tsysh-mjndvw6a7rr","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6k6mz","title":"Detailed gap analysis: Compare C# vs Rust line-by-line for DoLcsAlgorithm","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:28:39.596Z","updated_at":"2025-12-26T21:28:39.596Z","parent_id":"cell--tsysh-mjndvw6a7rr","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6nvuy","title":"Detailed gap analysis: Compare C# vs Rust for DoLcsAlgorithmForTable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T21:28:39.599Z","updated_at":"2025-12-26T21:28:39.599Z","parent_id":"cell--tsysh-mjndvw6a7rr","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6pjra","title":"Port missing DoLcsAlgorithm edge case logic from C# (lines 6248-7144)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:28:39.601Z","updated_at":"2025-12-26T21:28:39.601Z","parent_id":"cell--tsysh-mjndvw6a7rr","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjndvw6q0up","title":"Create comprehensive gap analysis report document","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T21:28:39.602Z","updated_at":"2025-12-26T21:28:39.602Z","parent_id":"cell--tsysh-mjndvw6a7rr","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpk5g6p","title":"LCS Algorithm C# Parity Gaps (from Synthesis Report)","description":"**Status:** üî¥ CRITICAL - NOT PRODUCTION READY\n\nImplementation gaps identified in SYNTHESIS_LCS_GAP_ANALYSIS.md (Dec 26, 2025).\nRust LCS algorithm is ~60% complete compared to C# reference.\n\n**Total Missing Logic:** ~500-600 lines of critical C# code\n**Estimated Effort:** 6-8 weeks with dedicated resource\n\n## Gap Summary\n- P0-1: Paragraph boundary preservation in DoLcsAlgorithm (4-5 days)\n- P0-2: Table merged cell detection (2-3 days)  \n- P0-3: Content type grouping logic (3-4 days)\n- P1-1: Paragraph-aware splitting in FindCommonAtBeginningAndEnd (1-2 days)\n\n## Source\nSee: history/SYNTHESIS_LCS_GAP_ANALYSIS.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T21:48:44.069Z","updated_at":"2025-12-26T21:48:44.069Z","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkbj8j","title":"P0-1: Paragraph boundary preservation in DoLcsAlgorithm","description":"**Impact:** Core correctness - paragraphs split incorrectly, broken document structure\n**C# Lines:** 6927-7130 (~204 lines)\n**Rust Status:** ‚ùå NOT IMPLEMENTED\n**Effort:** 4-5 days implementation + 2-3 days testing\n\n## Missing Logic\n\n1. **Pre-LCS paragraph content calculation** (C# 6936-6987)\n   - Calculate `remainingInLeftParagraph` / `remainingInRightParagraph`\n   - Determine how much content before LCS match belongs to same paragraph\n\n2. **Before-paragraph content handling** (C# 6989-7028)\n   - Create Deleted/Inserted/Unknown sequences for content before current paragraph\n\n3. **Within-paragraph remainder handling** (C# 7030-7069)\n   - Handle content within same paragraph as LCS but before match starts\n\n4. **Post-LCS paragraph extension** (C# 7095-7122)\n   - When LCS doesn't end on paragraph boundary, extend Unknown to next paragraph mark\n\n## Current Rust Behavior (WRONG)\n```rust\n// Lines 813-846: Simple prefix/match/suffix with NO paragraph awareness\nnew_sequence.push(CorrelatedSequence {\n    comparison_unit_array_1: cul1[..current_i1].to_vec(),\n    comparison_unit_array_2: cul2[..current_i2].to_vec(),\n    correlation_status: CorrelationStatus::Unknown,\n});\n```\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-1)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:6927-7130","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.075Z","updated_at":"2025-12-26T21:49:00.124Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpke7yi","title":"P0-1a: Implement FindIndexOfNextParaMark helper","description":"**C# Lines:** 7133-7143 (~10 lines)\n**Effort:** 0.5 days\n\n## Required Implementation\nHelper function to find the index of the next paragraph mark in a ComparisonUnit array.\n\n```csharp\n// C# 7133-7143\nprivate static int FindIndexOfNextParaMark(ComparisonUnit[] cua, int start) {\n    for (int i = start; i < cua.Length; i++) {\n        if (IsParagraphMark(cua[i]))\n            return i;\n    }\n    return -1;\n}\n```\n\n## Dependency\nRequired by P0-1 (paragraph boundary preservation) for post-LCS paragraph extension logic.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-1)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:7133-7143","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.078Z","updated_at":"2025-12-26T21:49:03.262Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkhirk","title":"P0-2a: Implement XML element navigation for ComparisonUnit","description":"**C# Lines:** 7181-7195 (~14 lines)\n**Effort:** 1-2 days\n\n## Required Implementation\n\nNavigate from ComparisonUnitGroup to XML table element:\n\n```csharp\n// C# 7181-7195\nvar firstContentAtom = tblGroup.DescendantContentAtoms().FirstOrDefault();\nvar tblElement = firstContentAtom\n    .AncestorElements\n    .Reverse()\n    .FirstOrDefault(a => a.Name == W.tbl);\n```\n\n## Rust Requirements\n1. Add `descendant_content_atoms()` method to `ComparisonUnitGroup`\n2. Add `ancestor_elements` access to `ComparisonUnitAtom`\n3. Implement XML traversal to find parent table element\n\n## Dependency\nRequired by P0-2b (merged cell detection). Without this, cannot navigate from comparison units to XML structure.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-2)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:7181-7195","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.081Z","updated_at":"2025-12-26T21:49:08.024Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkjx2m","title":"P0-2b: Implement merged cell detection (check_table_has_merged_cells)","description":"**Impact:** Incorrect diffs for tables with merged cells (silent failures)\n**C# Lines:** 7197-7203 (~6 lines)\n**Rust Status:** ‚ö†Ô∏è STUB IMPLEMENTATION (always returns `false`)\n**Effort:** 1-2 days implementation + 1-2 days testing\n\n## Current Stub (WRONG)\n```rust\n// redline-rs/crates/redline-core/src/wml/lcs_algorithm.rs:1434-1436\nfn check_table_has_merged_cells(_table_group: &ComparisonUnitGroup) -> bool {\n    false  // ‚ö†Ô∏è ALWAYS RETURNS FALSE\n}\n```\n\n## Required Implementation\n```csharp\n// C# 7197-7203\nvar containsMerged = tblElement\n    .Descendants()\n    .Any(d => d.Name == W.vMerge || d.Name == W.gridSpan);\n```\n\n## Why Critical\n- Without this, merged cell logic (Branches 2 & 3 in DoLcsAlgorithmForTable) **never executes**\n- Algorithm works ONLY for simple tables without merged cells\n- ~40% of table comparison logic is effectively disabled\n\n## Dependencies\nRequires P0-2a (XML element navigation) to be completed first.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-2)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:7197-7203","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.083Z","updated_at":"2025-12-26T21:49:14.492Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpklw3l","title":"P0-3a: Implement mixed content paragraph mark priority logic","description":"**Impact:** Incorrect handling of mixed content (paragraphs + tables)\n**C# Lines:** 6827-6910 (~83 lines)\n**Effort:** 1-2 days implementation + 1 day testing\n\n## Missing Logic\n\nCheck if word groups end with paragraph marks to determine ordering:\n\n```csharp\n// C# 6827-6910\nvar firstWordIsParaMark = /* check first left word */;\nvar secondWordIsParaMark = /* check first right word */;\n\nif (firstWordIsParaMark && !secondWordIsParaMark) {\n    // Delete words first, then insert table\n} else {\n    // Insert table first, then delete words\n}\n```\n\n## Why Critical\nControls ordering of Deleted/Inserted sequences for mixed content. Wrong ordering produces incorrect diff output.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-3)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:6827-6910","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.085Z","updated_at":"2025-12-26T21:49:18.495Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkm5vg","title":"P0-3b: Implement cell content flattening","description":"**Impact:** Optimization for cell-level comparisons\n**C# Lines:** 6771-6824 (~54 lines)\n**Effort:** 1-2 days implementation + 1 day testing\n\n## Missing Logic\n\n```csharp\n// C# 6771-6824\nif (firstIsCell && secondIsCell) {\n    var unknownCorrelatedSequence = new CorrelatedSequence();\n    unknownCorrelatedSequence.ComparisonUnitArray1 = \n        unknown.ComparisonUnitArray1\n        .SelectMany(cu => FlattenToComparisonUnitWordList(cu))\n        .ToArray();\n    // Recursively process flattened cell contents\n}\n```\n\n## Why Critical\n- Optimization for comparing table cells\n- Flattens cell contents to word-level for more granular comparison\n- Without this, cell comparisons may be less accurate\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-3)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:6771-6824","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.086Z","updated_at":"2025-12-26T21:49:22.745Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkpcf6","title":"P0-3c: Implement word/row conflict resolution","description":"**Impact:** Prevents incorrect diff ordering\n**C# Lines:** ~83 lines (scattered through content type grouping)\n**Effort:** 2-3 days implementation + 1 day testing\n\n## Missing Logic\n\nDetect word vs row type mismatches and order Deleted/Inserted based on paragraph mark presence.\n\n## Why Critical\n- Word/row conflicts can occur in mixed content documents\n- Incorrect resolution leads to wrong diff ordering\n- Affects documents with tables adjacent to paragraphs\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P0-3)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs (content type grouping section)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-26T21:48:44.089Z","updated_at":"2025-12-26T21:49:25.951Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpks39l","title":"P1-1: Implement paragraph-aware prefix splitting in FindCommonAtBeginningAndEnd","description":"**Impact:** Less granular correlation after common prefixes\n**C# Lines:** 4548-4605 (~57 lines)\n**Rust Status:** ‚ùå NOT IMPLEMENTED\n**Effort:** 1-2 days implementation + 1 day testing\n\n## Missing Logic\n\nAfter finding a common prefix, when both sides have remaining content:\n\n```csharp\n// C# 4548-4605\nvar first1 = commonSeq[commonSeq.Length - 1] as ComparisonUnitWord;\nvar lastContentAtom = first1?.DescendantContentAtoms().LastOrDefault();\n\nif (lastContentAtom != null && lastContentAtom.ContentElement.Name != W.pPr) {\n    var remaining1Split = SplitAtParagraphMark(remaining1);\n    var remaining2Split = SplitAtParagraphMark(remaining2);\n    \n    if (remaining1Split.Length == 1 && remaining2Split.Length == 1) {\n        // Create 1 Unknown\n    } else if (remaining1Split.Length == 2 && remaining2Split.Length == 2) {\n        // Create 2 Unknowns (before/after paragraph mark)\n    }\n}\n```\n\n## Current Rust Behavior (LESS GRANULAR)\n```rust\n// Lines 428-432: Always create single Unknown\nnew_sequence.push(CorrelatedSequence {\n    comparison_unit_array_1: units1[count_common_at_beginning..].to_vec(),\n    comparison_unit_array_2: units2[count_common_at_beginning..].to_vec(),\n    correlation_status: CorrelationStatus::Unknown,\n});\n```\n\n## Impact Analysis\n- Rust produces one large Unknown where C# produces multiple smaller Unknowns\n- Affects downstream comparison granularity\n- May reduce revision tracking accuracy at paragraph boundaries\n\n## Dependencies\nRequires P1-1a (SplitAtParagraphMark helper) to be completed first.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P1-1)\n- C# Source: OpenXmlPowerTools/WmlComparer.cs:4548-4605","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:48:44.092Z","updated_at":"2025-12-26T21:49:33.899Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkukc9","title":"P1-1a: Implement SplitAtParagraphMark helper","description":"**C# Lines:** ~20 lines\n**Effort:** 0.5-1 day\n\n## Required Implementation\n\nHelper function to split a ComparisonUnit array at paragraph mark boundaries.\n\n```csharp\n// Split array at first paragraph mark found\nprivate static ComparisonUnit[][] SplitAtParagraphMark(ComparisonUnit[] cua) {\n    for (int i = 0; i < cua.Length; i++) {\n        if (IsParagraphMark(cua[i])) {\n            return new[] {\n                cua.Take(i + 1).ToArray(),  // Including para mark\n                cua.Skip(i + 1).ToArray()   // After para mark\n            };\n        }\n    }\n    return new[] { cua };  // No para mark found\n}\n```\n\n## Dependency\nRequired by P1-1 (paragraph-aware prefix splitting).\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (P1-1)\n- Consider creating `paragraph_utils.rs` module for this and FindIndexOfNextParaMark","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:48:44.094Z","updated_at":"2025-12-26T21:49:37.646Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkwuoq","title":"Create test suite for merged cell tables","description":"**Priority:** P1\n**Effort:** 1-2 days\n\n## Purpose\nValidate that merged cell detection (P0-2b) works correctly.\n\n## Test Cases Needed\n1. Simple table (no merged cells) - should return false\n2. Table with horizontal merge (gridSpan) - should return true\n3. Table with vertical merge (vMerge) - should return true\n4. Table with both horizontal and vertical merges - should return true\n5. Nested table with merged cells in inner table\n6. Comparing two tables where one has merged cells\n\n## Test Documents\nCreate test DOCX files with various merged cell configurations.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (Testing section)\n- Validates: P0-2b implementation","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:48:44.096Z","updated_at":"2025-12-26T21:49:41.108Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpkzs8z","title":"Create test suite for mixed content scenarios","description":"**Priority:** P1\n**Effort:** 1-2 days\n\n## Purpose\nValidate that mixed content handling (P0-3a, P0-3b, P0-3c) works correctly.\n\n## Test Cases Needed\n1. Paragraph followed by table - insertion/deletion ordering\n2. Table followed by paragraph - insertion/deletion ordering\n3. Alternating paragraphs and tables\n4. Paragraph ending with text vs paragraph ending with para mark\n5. Table row adjacent to paragraph\n6. Cell content vs word content comparison\n\n## Test Documents\nCreate test DOCX files with various mixed content configurations.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (Testing section)\n- Validates: P0-3a, P0-3b, P0-3c implementations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:48:44.099Z","updated_at":"2025-12-26T21:49:44.091Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
{"id":"cell--tsysh-mjnelpl1wn7","title":"Create test suite for paragraph boundary edge cases","description":"**Priority:** P1\n**Effort:** 1-2 days\n\n## Purpose\nValidate that paragraph boundary preservation (P0-1) works correctly.\n\n## Test Cases Needed\n1. LCS match spans paragraph boundary - should split correctly\n2. Content before paragraph in left only - should be Deleted\n3. Content before paragraph in right only - should be Inserted\n4. Content before paragraph in both - should be Unknown\n5. LCS ends mid-paragraph - should extend to next para mark\n6. Multiple paragraphs with partial matches\n7. Empty paragraph handling\n8. Paragraph with only whitespace\n\n## Test Documents\nCreate test DOCX files with various paragraph boundary scenarios.\n\n## Reference\n- Source: history/SYNTHESIS_LCS_GAP_ANALYSIS.md (Testing section)\n- Validates: P0-1, P0-1a implementations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T21:48:44.101Z","updated_at":"2025-12-26T21:49:46.858Z","parent_id":"cell--tsysh-mjnelpk5g6p","dependencies":[],"labels":[],"comments":[]}
